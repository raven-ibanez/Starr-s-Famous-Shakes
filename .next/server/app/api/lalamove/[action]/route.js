"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/lalamove/[action]/route";
exports.ids = ["app/api/lalamove/[action]/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Flalamove%2F%5Baction%5D%2Froute&page=%2Fapi%2Flalamove%2F%5Baction%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Flalamove%2F%5Baction%5D%2Froute.ts&appDir=%2FUsers%2Fcodemedavid%2FDocuments%2Fstarrs%2FStarr-s-Famous-Shakes%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fcodemedavid%2FDocuments%2Fstarrs%2FStarr-s-Famous-Shakes&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Flalamove%2F%5Baction%5D%2Froute&page=%2Fapi%2Flalamove%2F%5Baction%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Flalamove%2F%5Baction%5D%2Froute.ts&appDir=%2FUsers%2Fcodemedavid%2FDocuments%2Fstarrs%2FStarr-s-Famous-Shakes%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fcodemedavid%2FDocuments%2Fstarrs%2FStarr-s-Famous-Shakes&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   headerHooks: () => (/* binding */ headerHooks),\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage),\n/* harmony export */   staticGenerationBailout: () => (/* binding */ staticGenerationBailout)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_node_polyfill_headers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/node-polyfill-headers */ \"(rsc)/./node_modules/next/dist/server/node-polyfill-headers.js\");\n/* harmony import */ var next_dist_server_node_polyfill_headers__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_node_polyfill_headers__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var _Users_codemedavid_Documents_starrs_Starr_s_Famous_Shakes_app_api_lalamove_action_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/lalamove/[action]/route.ts */ \"(rsc)/./app/api/lalamove/[action]/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_1__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_2__.RouteKind.APP_ROUTE,\n        page: \"/api/lalamove/[action]/route\",\n        pathname: \"/api/lalamove/[action]\",\n        filename: \"route\",\n        bundlePath: \"app/api/lalamove/[action]/route\"\n    },\n    resolvedPagePath: \"/Users/codemedavid/Documents/starrs/Starr-s-Famous-Shakes/app/api/lalamove/[action]/route.ts\",\n    nextConfigOutput,\n    userland: _Users_codemedavid_Documents_starrs_Starr_s_Famous_Shakes_app_api_lalamove_action_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout } = routeModule;\nconst originalPathname = \"/api/lalamove/[action]/route\";\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZsYWxhbW92ZSUyRiU1QmFjdGlvbiU1RCUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGbGFsYW1vdmUlMkYlNUJhY3Rpb24lNUQlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZsYWxhbW92ZSUyRiU1QmFjdGlvbiU1RCUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmNvZGVtZWRhdmlkJTJGRG9jdW1lbnRzJTJGc3RhcnJzJTJGU3RhcnItcy1GYW1vdXMtU2hha2VzJTJGYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj0lMkZVc2VycyUyRmNvZGVtZWRhdmlkJTJGRG9jdW1lbnRzJTJGc3RhcnJzJTJGU3RhcnItcy1GYW1vdXMtU2hha2VzJmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQWdEO0FBQ3NEO0FBQ3ZDO0FBQzBEO0FBQ3pIO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsdUdBQXVHO0FBQy9HO0FBQ2lKOztBQUVqSiIsInNvdXJjZXMiOlsid2VicGFjazovL3N0YXJycy1mYW1vdXMtc2hha2VzLz9mMTYwIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBcIm5leHQvZGlzdC9zZXJ2ZXIvbm9kZS1wb2x5ZmlsbC1oZWFkZXJzXCI7XG5pbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIvVXNlcnMvY29kZW1lZGF2aWQvRG9jdW1lbnRzL3N0YXJycy9TdGFyci1zLUZhbW91cy1TaGFrZXMvYXBwL2FwaS9sYWxhbW92ZS9bYWN0aW9uXS9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvbGFsYW1vdmUvW2FjdGlvbl0vcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9sYWxhbW92ZS9bYWN0aW9uXVwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvbGFsYW1vdmUvW2FjdGlvbl0vcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMvY29kZW1lZGF2aWQvRG9jdW1lbnRzL3N0YXJycy9TdGFyci1zLUZhbW91cy1TaGFrZXMvYXBwL2FwaS9sYWxhbW92ZS9bYWN0aW9uXS9yb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBoZWFkZXJIb29rcywgc3RhdGljR2VuZXJhdGlvbkJhaWxvdXQgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS9sYWxhbW92ZS9bYWN0aW9uXS9yb3V0ZVwiO1xuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBoZWFkZXJIb29rcywgc3RhdGljR2VuZXJhdGlvbkJhaWxvdXQsIG9yaWdpbmFsUGF0aG5hbWUsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Flalamove%2F%5Baction%5D%2Froute&page=%2Fapi%2Flalamove%2F%5Baction%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Flalamove%2F%5Baction%5D%2Froute.ts&appDir=%2FUsers%2Fcodemedavid%2FDocuments%2Fstarrs%2FStarr-s-Famous-Shakes%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fcodemedavid%2FDocuments%2Fstarrs%2FStarr-s-Famous-Shakes&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/lalamove/[action]/route.ts":
/*!********************************************!*\
  !*** ./app/api/lalamove/[action]/route.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   OPTIONS: () => (/* binding */ OPTIONS),\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   runtime: () => (/* binding */ runtime)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(rsc)/./node_modules/next/dist/server/web/exports/next-response.js\");\n\nconst API_BASE_URL = \"https://rest.lalamove.com/v3\";\nconst API_SANDBOX_URL = \"https://rest.sandbox.lalamove.com/v3\";\nconst CORS_HEADERS = {\n    \"Access-Control-Allow-Origin\": \"*\",\n    \"Access-Control-Allow-Methods\": \"POST, OPTIONS\",\n    \"Access-Control-Allow-Headers\": \"Content-Type, Authorization\"\n};\nconst respond = (body, status = 200)=>next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json(body, {\n        status,\n        headers: CORS_HEADERS\n    });\nconst getEnv = (key)=>{\n    const value = process.env[key];\n    if (!value) {\n        throw new Error(`Missing env var ${key}`);\n    }\n    return value;\n};\nconst signPayload = async (method, path, body, secret)=>{\n    const timestamp = new Date().getTime().toString();\n    const encoder = new TextEncoder();\n    const key = await crypto.subtle.importKey(\"raw\", encoder.encode(secret), {\n        name: \"HMAC\",\n        hash: \"SHA-256\"\n    }, false, [\n        \"sign\"\n    ]);\n    const message = `${timestamp}\\r\\n${method}\\r\\n${path}\\r\\n\\r\\n${body}`;\n    const signatureBuffer = await crypto.subtle.sign(\"HMAC\", key, encoder.encode(message));\n    const signature = Buffer.from(signatureBuffer).toString(\"hex\");\n    return {\n        timestamp,\n        signature\n    };\n};\nconst getLanguageForMarket = (market)=>{\n    const map = {\n        HK: \"en_HK\",\n        SG: \"en_SG\",\n        TH: \"th_TH\",\n        PH: \"en_PH\",\n        TW: \"zh_TW\",\n        MY: \"ms_MY\",\n        VN: \"vi_VN\"\n    };\n    return map[market] || \"en_US\";\n};\nconst createStops = (config, deliveryAddress, deliveryCoordinates, language)=>[\n        {\n            coordinates: {\n                lat: config.storeLatitude.toString(),\n                lng: config.storeLongitude.toString()\n            },\n            address: config.storeAddress\n        },\n        {\n            coordinates: {\n                lat: deliveryCoordinates.lat.toString(),\n                lng: deliveryCoordinates.lng.toString()\n            },\n            address: deliveryAddress\n        }\n    ];\nconst buildUpstreamUrl = (path, sandbox)=>{\n    const base = sandbox ? API_SANDBOX_URL : API_BASE_URL;\n    return `${base}${path}`;\n};\nconst proxyRequest = async (path, payload, market, sandbox, method = \"POST\")=>{\n    const secret = getEnv(\"LALAMOVE_API_SECRET\");\n    const apiKey = getEnv(\"LALAMOVE_API_KEY\");\n    const bodyString = method === \"GET\" ? \"\" : JSON.stringify(payload);\n    // Lalamove expects the path in the signature to include the version (e.g., /v3/quotations)\n    const signaturePath = `/v3${path}`;\n    const { signature, timestamp } = await signPayload(method, signaturePath, bodyString, secret);\n    const upstreamUrl = buildUpstreamUrl(path, sandbox);\n    const upstreamResponse = await fetch(upstreamUrl, {\n        method,\n        headers: {\n            \"Content-Type\": \"application/json; charset=utf-8\",\n            \"Market\": market,\n            Authorization: `hmac ${apiKey}:${timestamp}:${signature}`,\n            \"Accept\": \"application/json\"\n        },\n        ...method !== \"GET\" && {\n            body: bodyString\n        }\n    });\n    const responseBody = await upstreamResponse.text();\n    if (!upstreamResponse.ok) {\n        console.error(\"Lalamove upstream error\", {\n            status: upstreamResponse.status,\n            body: responseBody,\n            url: upstreamUrl,\n            payload\n        });\n        return {\n            error: responseBody || \"Lalamove upstream error\",\n            status: upstreamResponse.status\n        };\n    }\n    return {\n        data: JSON.parse(responseBody)\n    };\n};\nconst buildConfig = (body)=>{\n    if (!body) return null;\n    const market = String(body.market || \"\");\n    const serviceType = String(body.serviceType || \"\");\n    const storeName = String(body.storeName || \"\");\n    const storePhone = String(body.storePhone || \"\");\n    const storeAddress = String(body.storeAddress || \"\");\n    const storeLatitude = Number(body.storeLatitude);\n    const storeLongitude = Number(body.storeLongitude);\n    const sandbox = Boolean(body.sandbox);\n    if (!market || !serviceType || !storeName || !storePhone || !storeAddress || Number.isNaN(storeLatitude) || Number.isNaN(storeLongitude)) {\n        return null;\n    }\n    return {\n        market,\n        serviceType,\n        sandbox,\n        storeName,\n        storePhone,\n        storeAddress,\n        storeLatitude,\n        storeLongitude\n    };\n};\nconst handleQuote = async (body, config)=>{\n    const deliveryAddress = String(body.deliveryAddress || \"\");\n    const deliveryLat = Number(body.deliveryLat);\n    const deliveryLng = Number(body.deliveryLng);\n    if (!deliveryAddress || Number.isNaN(deliveryLat) || Number.isNaN(deliveryLng)) {\n        return respond({\n            error: \"Missing delivery fields\"\n        }, 400);\n    }\n    const language = getLanguageForMarket(config.market);\n    const quotePayload = {\n        data: {\n            serviceType: config.serviceType,\n            language,\n            stops: createStops(config, deliveryAddress, {\n                lat: deliveryLat,\n                lng: deliveryLng\n            }, language),\n            item: {\n                quantity: \"1\",\n                weight: \"LESS_THAN_3_KG\",\n                categories: [\n                    \"FOOD_DELIVERY\"\n                ],\n                handlingInstructions: [\n                    \"KEEP_UPRIGHT\"\n                ]\n            }\n        }\n    };\n    const result = await proxyRequest(\"/quotations\", quotePayload, config.market, config.sandbox);\n    if (\"error\" in result) {\n        return respond({\n            error: result.error\n        }, result.status || 500);\n    }\n    return respond({\n        quotationId: result.data.data?.quotationId,\n        price: result.data.data?.priceBreakdown?.total,\n        currency: result.data.data?.priceBreakdown?.currency,\n        expiresAt: result.data.data?.expiresAt\n    });\n};\nconst handleOrder = async (body, config)=>{\n    const quotationId = String(body.quotationId || \"\");\n    const recipientName = String(body.recipientName || \"\");\n    const recipientPhone = String(body.recipientPhone || \"\");\n    if (!quotationId || !recipientName || !recipientPhone) {\n        return respond({\n            error: \"Missing order fields\"\n        }, 400);\n    }\n    // Normalize phone numbers to e.164 format\n    const normalizePhone = (phone)=>{\n        if (!phone) return phone;\n        const digits = phone.replace(/\\D/g, \"\");\n        if (!digits) return phone;\n        if (digits.startsWith(\"63\")) {\n            return `+${digits}`;\n        } else if (digits.startsWith(\"0\")) {\n            return `+63${digits.slice(1)}`;\n        } else if (digits.startsWith(\"9\")) {\n            return `+63${digits}`;\n        } else {\n            return `+63${digits}`;\n        }\n    };\n    // Fetch quotation to get stop IDs (if not provided)\n    let senderStopId = body.senderStopId;\n    let recipientStopId = body.recipientStopId;\n    let quotationScheduleAt = undefined;\n    let shouldUseScheduleAt = false;\n    if (!senderStopId || !recipientStopId) {\n        try {\n            // Fetch quotation to get stop IDs\n            const quoteResult = await proxyRequest(`/quotations/${quotationId}`, {}, config.market, config.sandbox, \"GET\");\n            if (\"error\" in quoteResult) {\n                console.error(\"Failed to fetch quotation:\", quoteResult.error);\n                return respond({\n                    error: `Failed to fetch quotation: ${quoteResult.error}`\n                }, quoteResult.status || 500);\n            }\n            const quotation = quoteResult.data?.data || quoteResult.data;\n            // Log quotation structure for debugging\n            console.log(\"Quotation response structure:\", JSON.stringify(quotation, null, 2));\n            // Check if quotation has expired\n            const expiresAt = quotation?.expiresAt;\n            const now = new Date();\n            if (expiresAt) {\n                const expirationTime = new Date(expiresAt);\n                if (now > expirationTime) {\n                    console.error(\"Quotation has expired:\", {\n                        quotationId,\n                        expiresAt,\n                        currentTime: now.toISOString(),\n                        timeDifference: now.getTime() - expirationTime.getTime()\n                    });\n                    return respond({\n                        error: `Quotation has expired. Expired at ${expiresAt}. Please request a new quotation.`\n                    }, 400);\n                }\n            }\n            // Check scheduleAt time if present\n            const scheduleAt = quotation?.scheduleAt;\n            quotationScheduleAt = scheduleAt;\n            if (scheduleAt) {\n                const scheduleTime = new Date(scheduleAt);\n                const timeDiff = scheduleTime.getTime() - now.getTime();\n                const minutesDiff = timeDiff / (1000 * 60);\n                // If schedule time is in the past but within 10 minutes, treat as immediate delivery\n                // This handles cases where Lalamove sets a scheduleAt time that passes quickly\n                if (scheduleTime < now) {\n                    const minutesPast = Math.abs(minutesDiff);\n                    if (minutesPast <= 10) {\n                        // Schedule time is in the past but within tolerance - treat as immediate\n                        console.warn(\"Quotation schedule time is in the past but within tolerance, treating as immediate delivery:\", {\n                            quotationId,\n                            scheduleAt,\n                            currentTime: now.toISOString(),\n                            minutesPast: minutesPast.toFixed(2)\n                        });\n                        shouldUseScheduleAt = false; // Don't include scheduleAt in order payload\n                    } else {\n                        // Schedule time is significantly in the past - reject\n                        console.error(\"Quotation schedule time is too far in the past:\", {\n                            quotationId,\n                            scheduleAt,\n                            currentTime: now.toISOString(),\n                            minutesPast: minutesPast.toFixed(2)\n                        });\n                        return respond({\n                            error: `Quotation schedule time (${scheduleAt}) is too far in the past (${minutesPast.toFixed(0)} minutes). Please request a new quotation for immediate delivery.`\n                        }, 400);\n                    }\n                } else {\n                    // Schedule time is in the future\n                    const hoursUntilSchedule = timeDiff / (1000 * 60 * 60);\n                    // If schedule time is too far in the future (more than 24 hours), warn but allow\n                    if (hoursUntilSchedule > 24) {\n                        console.warn(\"Quotation schedule time is more than 24 hours away:\", {\n                            quotationId,\n                            scheduleAt,\n                            hoursUntilSchedule\n                        });\n                    }\n                    // Use the scheduleAt for future scheduled deliveries\n                    shouldUseScheduleAt = true;\n                    console.log(\"Using scheduled quotation:\", {\n                        quotationId,\n                        scheduleAt,\n                        hoursUntilSchedule: hoursUntilSchedule.toFixed(2)\n                    });\n                }\n            }\n            // Try different possible response structures\n            // Lalamove returns stops with 'stopId' field (not 'id')\n            const stops = quotation?.stops || quotation?.data?.stops || [];\n            senderStopId = stops[0]?.stopId || stops[0]?.id || \"\";\n            recipientStopId = stops[1]?.stopId || stops[1]?.id || \"\";\n            if (!senderStopId || !recipientStopId) {\n                console.error(\"Missing stop IDs in quotation:\", {\n                    quotationId,\n                    stops,\n                    quotationStructure: Object.keys(quotation || {})\n                });\n                return respond({\n                    error: \"Failed to extract stop IDs from quotation. Please check quotation response structure.\"\n                }, 500);\n            }\n        } catch (error) {\n            console.error(\"Error fetching quotation:\", error);\n            return respond({\n                error: \"Failed to fetch quotation for stop IDs\"\n            }, 500);\n        }\n    }\n    // Normalize all phone numbers\n    const normalizedStorePhone = normalizePhone(config.storePhone);\n    const normalizedRecipientPhone = normalizePhone(recipientPhone);\n    // Build order payload\n    const orderPayload = {\n        data: {\n            quotationId,\n            sender: {\n                stopId: senderStopId,\n                name: config.storeName,\n                phone: normalizedStorePhone\n            },\n            recipients: [\n                {\n                    stopId: recipientStopId,\n                    name: recipientName,\n                    phone: normalizedRecipientPhone,\n                    remarks: body.recipientRemarks || \"\"\n                }\n            ],\n            isPODEnabled: true,\n            metadata: body.metadata || {}\n        }\n    };\n    // Only include scheduleAt if it's valid and in the future (not treated as immediate)\n    // If scheduleAt is in the past but within tolerance, we omit it to treat as immediate delivery\n    if (shouldUseScheduleAt && quotationScheduleAt) {\n        orderPayload.data.scheduleAt = quotationScheduleAt;\n    }\n    // Log payload for debugging (without sensitive data)\n    console.log(\"Lalamove order payload:\", {\n        quotationId,\n        senderStopId,\n        recipientStopId,\n        senderPhone: normalizedStorePhone,\n        recipientPhone: normalizedRecipientPhone\n    });\n    const result = await proxyRequest(\"/orders\", orderPayload, config.market, config.sandbox);\n    if (\"error\" in result) {\n        return respond({\n            error: result.error\n        }, result.status || 500);\n    }\n    return respond({\n        orderId: result.data.data?.orderId,\n        status: result.data.data?.status,\n        shareLink: result.data.data?.shareLink,\n        driverId: result.data.data?.driverId\n    });\n};\nconst runtime = \"nodejs\";\nasync function OPTIONS() {\n    return new next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"](null, {\n        status: 204,\n        headers: CORS_HEADERS\n    });\n}\nasync function POST(request, { params }) {\n    const action = params.action;\n    if (action !== \"quote\" && action !== \"order\") {\n        return respond({\n            error: \"Action not supported\"\n        }, 405);\n    }\n    let body;\n    try {\n        body = await request.json();\n    } catch (error) {\n        return respond({\n            error: \"Invalid JSON payload\"\n        }, 400);\n    }\n    const config = buildConfig(body);\n    if (!config) {\n        return respond({\n            error: \"Invalid delivery store configuration\"\n        }, 400);\n    }\n    if (action === \"quote\") {\n        return handleQuote(body, config);\n    }\n    return handleOrder(body, config);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL2xhbGFtb3ZlL1thY3Rpb25dL3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBd0Q7QUFleEQsTUFBTUMsZUFBZTtBQUNyQixNQUFNQyxrQkFBa0I7QUFFeEIsTUFBTUMsZUFBZTtJQUNuQiwrQkFBK0I7SUFDL0IsZ0NBQWdDO0lBQ2hDLGdDQUFnQztBQUNsQztBQUVBLE1BQU1DLFVBQVUsQ0FBQ0MsTUFBZUMsU0FBUyxHQUFHLEdBQzFDTixrRkFBWUEsQ0FBQ08sSUFBSSxDQUFDRixNQUFNO1FBQUVDO1FBQVFFLFNBQVNMO0lBQWE7QUFFMUQsTUFBTU0sU0FBUyxDQUFDQztJQUNkLE1BQU1DLFFBQVFDLFFBQVFDLEdBQUcsQ0FBQ0gsSUFBSTtJQUM5QixJQUFJLENBQUNDLE9BQU87UUFDVixNQUFNLElBQUlHLE1BQU0sQ0FBQyxnQkFBZ0IsRUFBRUosSUFBSSxDQUFDO0lBQzFDO0lBQ0EsT0FBT0M7QUFDVDtBQUVBLE1BQU1JLGNBQWMsT0FBT0MsUUFBZ0JDLE1BQWNaLE1BQWNhO0lBQ3JFLE1BQU1DLFlBQVksSUFBSUMsT0FBT0MsT0FBTyxHQUFHQyxRQUFRO0lBQy9DLE1BQU1DLFVBQVUsSUFBSUM7SUFDcEIsTUFBTWQsTUFBTSxNQUFNZSxPQUFPQyxNQUFNLENBQUNDLFNBQVMsQ0FDdkMsT0FDQUosUUFBUUssTUFBTSxDQUFDVixTQUNmO1FBQUVXLE1BQU07UUFBUUMsTUFBTTtJQUFVLEdBQ2hDLE9BQ0E7UUFBQztLQUFPO0lBRVYsTUFBTUMsVUFBVSxDQUFDLEVBQUVaLFVBQVUsSUFBSSxFQUFFSCxPQUFPLElBQUksRUFBRUMsS0FBSyxRQUFRLEVBQUVaLEtBQUssQ0FBQztJQUNyRSxNQUFNMkIsa0JBQWtCLE1BQU1QLE9BQU9DLE1BQU0sQ0FBQ08sSUFBSSxDQUFDLFFBQVF2QixLQUFLYSxRQUFRSyxNQUFNLENBQUNHO0lBQzdFLE1BQU1HLFlBQVlDLE9BQU9DLElBQUksQ0FBQ0osaUJBQWlCVixRQUFRLENBQUM7SUFD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LEVBQ3BCLEVBQUVDLE1BQU0sRUFBa0M7SUFFMUMsTUFBTUMsU0FBU0QsT0FBT0MsTUFBTTtJQUM1QixJQUFJQSxXQUFXLFdBQVdBLFdBQVcsU0FBUztRQUM1QyxPQUFPN0osUUFBUTtZQUFFeUUsT0FBTztRQUF1QixHQUFHO0lBQ3BEO0lBRUEsSUFBSXhFO0lBQ0osSUFBSTtRQUNGQSxPQUFPLE1BQU0wSixRQUFReEosSUFBSTtJQUMzQixFQUFFLE9BQU9zRSxPQUFPO1FBQ2QsT0FBT3pFLFFBQVE7WUFBRXlFLE9BQU87UUFBdUIsR0FBRztJQUNwRDtJQUVBLE1BQU03QixTQUFTaUMsWUFBWTVFO0lBQzNCLElBQUksQ0FBQzJDLFFBQVE7UUFDWCxPQUFPNUMsUUFBUTtZQUFFeUUsT0FBTztRQUF1QyxHQUFHO0lBQ3BFO0lBRUEsSUFBSW9GLFdBQVcsU0FBUztRQUN0QixPQUFPeEUsWUFBWXBGLE1BQU0yQztJQUMzQjtJQUVBLE9BQU8wRCxZQUFZckcsTUFBTTJDO0FBQzNCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc3RhcnJzLWZhbW91cy1zaGFrZXMvLi9hcHAvYXBpL2xhbGFtb3ZlL1thY3Rpb25dL3JvdXRlLnRzPzM1ZDciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcblxudHlwZSBEZWxpdmVyeUNvb3JkaW5hdGVzID0geyBsYXQ6IG51bWJlcjsgbG5nOiBudW1iZXIgfTtcblxudHlwZSBEZWxpdmVyeVN0b3JlQ29uZmlnID0ge1xuICBtYXJrZXQ6IHN0cmluZztcbiAgc2VydmljZVR5cGU6IHN0cmluZztcbiAgc2FuZGJveDogYm9vbGVhbjtcbiAgc3RvcmVOYW1lOiBzdHJpbmc7XG4gIHN0b3JlUGhvbmU6IHN0cmluZztcbiAgc3RvcmVBZGRyZXNzOiBzdHJpbmc7XG4gIHN0b3JlTGF0aXR1ZGU6IG51bWJlcjtcbiAgc3RvcmVMb25naXR1ZGU6IG51bWJlcjtcbn07XG5cbmNvbnN0IEFQSV9CQVNFX1VSTCA9ICdodHRwczovL3Jlc3QubGFsYW1vdmUuY29tL3YzJztcbmNvbnN0IEFQSV9TQU5EQk9YX1VSTCA9ICdodHRwczovL3Jlc3Quc2FuZGJveC5sYWxhbW92ZS5jb20vdjMnO1xuXG5jb25zdCBDT1JTX0hFQURFUlMgPSB7XG4gICdBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW4nOiAnKicsXG4gICdBY2Nlc3MtQ29udHJvbC1BbGxvdy1NZXRob2RzJzogJ1BPU1QsIE9QVElPTlMnLFxuICAnQWNjZXNzLUNvbnRyb2wtQWxsb3ctSGVhZGVycyc6ICdDb250ZW50LVR5cGUsIEF1dGhvcml6YXRpb24nXG59O1xuXG5jb25zdCByZXNwb25kID0gKGJvZHk6IHVua25vd24sIHN0YXR1cyA9IDIwMCkgPT5cbiAgTmV4dFJlc3BvbnNlLmpzb24oYm9keSwgeyBzdGF0dXMsIGhlYWRlcnM6IENPUlNfSEVBREVSUyB9KTtcblxuY29uc3QgZ2V0RW52ID0gKGtleTogc3RyaW5nKSA9PiB7XG4gIGNvbnN0IHZhbHVlID0gcHJvY2Vzcy5lbnZba2V5XTtcbiAgaWYgKCF2YWx1ZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgTWlzc2luZyBlbnYgdmFyICR7a2V5fWApO1xuICB9XG4gIHJldHVybiB2YWx1ZTtcbn07XG5cbmNvbnN0IHNpZ25QYXlsb2FkID0gYXN5bmMgKG1ldGhvZDogc3RyaW5nLCBwYXRoOiBzdHJpbmcsIGJvZHk6IHN0cmluZywgc2VjcmV0OiBzdHJpbmcpID0+IHtcbiAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKS5nZXRUaW1lKCkudG9TdHJpbmcoKTtcbiAgY29uc3QgZW5jb2RlciA9IG5ldyBUZXh0RW5jb2RlcigpO1xuICBjb25zdCBrZXkgPSBhd2FpdCBjcnlwdG8uc3VidGxlLmltcG9ydEtleShcbiAgICAncmF3JyxcbiAgICBlbmNvZGVyLmVuY29kZShzZWNyZXQpLFxuICAgIHsgbmFtZTogJ0hNQUMnLCBoYXNoOiAnU0hBLTI1NicgfSxcbiAgICBmYWxzZSxcbiAgICBbJ3NpZ24nXVxuICApO1xuICBjb25zdCBtZXNzYWdlID0gYCR7dGltZXN0YW1wfVxcclxcbiR7bWV0aG9kfVxcclxcbiR7cGF0aH1cXHJcXG5cXHJcXG4ke2JvZHl9YDtcbiAgY29uc3Qgc2lnbmF0dXJlQnVmZmVyID0gYXdhaXQgY3J5cHRvLnN1YnRsZS5zaWduKCdITUFDJywga2V5LCBlbmNvZGVyLmVuY29kZShtZXNzYWdlKSk7XG4gIGNvbnN0IHNpZ25hdHVyZSA9IEJ1ZmZlci5mcm9tKHNpZ25hdHVyZUJ1ZmZlcikudG9TdHJpbmcoJ2hleCcpO1xuICByZXR1cm4geyB0aW1lc3RhbXAsIHNpZ25hdHVyZSB9O1xufTtcblxuY29uc3QgZ2V0TGFuZ3VhZ2VGb3JNYXJrZXQgPSAobWFya2V0OiBzdHJpbmcpID0+IHtcbiAgY29uc3QgbWFwOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge1xuICAgIEhLOiAnZW5fSEsnLFxuICAgIFNHOiAnZW5fU0cnLFxuICAgIFRIOiAndGhfVEgnLFxuICAgIFBIOiAnZW5fUEgnLFxuICAgIFRXOiAnemhfVFcnLFxuICAgIE1ZOiAnbXNfTVknLFxuICAgIFZOOiAndmlfVk4nXG4gIH07XG4gIHJldHVybiBtYXBbbWFya2V0XSB8fCAnZW5fVVMnO1xufTtcblxuY29uc3QgY3JlYXRlU3RvcHMgPSAoXG4gIGNvbmZpZzogRGVsaXZlcnlTdG9yZUNvbmZpZyxcbiAgZGVsaXZlcnlBZGRyZXNzOiBzdHJpbmcsXG4gIGRlbGl2ZXJ5Q29vcmRpbmF0ZXM6IERlbGl2ZXJ5Q29vcmRpbmF0ZXMsXG4gIGxhbmd1YWdlOiBzdHJpbmdcbikgPT4gW1xuICAgIHtcbiAgICAgIGNvb3JkaW5hdGVzOiB7XG4gICAgICAgIGxhdDogY29uZmlnLnN0b3JlTGF0aXR1ZGUudG9TdHJpbmcoKSxcbiAgICAgICAgbG5nOiBjb25maWcuc3RvcmVMb25naXR1ZGUudG9TdHJpbmcoKVxuICAgICAgfSxcbiAgICAgIGFkZHJlc3M6IGNvbmZpZy5zdG9yZUFkZHJlc3NcbiAgICB9LFxuICAgIHtcbiAgICAgIGNvb3JkaW5hdGVzOiB7XG4gICAgICAgIGxhdDogZGVsaXZlcnlDb29yZGluYXRlcy5sYXQudG9TdHJpbmcoKSxcbiAgICAgICAgbG5nOiBkZWxpdmVyeUNvb3JkaW5hdGVzLmxuZy50b1N0cmluZygpXG4gICAgICB9LFxuICAgICAgYWRkcmVzczogZGVsaXZlcnlBZGRyZXNzXG4gICAgfVxuICBdO1xuXG5jb25zdCBidWlsZFVwc3RyZWFtVXJsID0gKHBhdGg6IHN0cmluZywgc2FuZGJveDogYm9vbGVhbikgPT4ge1xuICBjb25zdCBiYXNlID0gc2FuZGJveCA/IEFQSV9TQU5EQk9YX1VSTCA6IEFQSV9CQVNFX1VSTDtcbiAgcmV0dXJuIGAke2Jhc2V9JHtwYXRofWA7XG59O1xuXG5jb25zdCBwcm94eVJlcXVlc3QgPSBhc3luYyAoXG4gIHBhdGg6IHN0cmluZyxcbiAgcGF5bG9hZDogUmVjb3JkPHN0cmluZywgdW5rbm93bj4sXG4gIG1hcmtldDogc3RyaW5nLFxuICBzYW5kYm94OiBib29sZWFuLFxuICBtZXRob2Q6IHN0cmluZyA9ICdQT1NUJ1xuKSA9PiB7XG4gIGNvbnN0IHNlY3JldCA9IGdldEVudignTEFMQU1PVkVfQVBJX1NFQ1JFVCcpO1xuICBjb25zdCBhcGlLZXkgPSBnZXRFbnYoJ0xBTEFNT1ZFX0FQSV9LRVknKTtcblxuICBjb25zdCBib2R5U3RyaW5nID0gbWV0aG9kID09PSAnR0VUJyA/ICcnIDogSlNPTi5zdHJpbmdpZnkocGF5bG9hZCk7XG4gIC8vIExhbGFtb3ZlIGV4cGVjdHMgdGhlIHBhdGggaW4gdGhlIHNpZ25hdHVyZSB0byBpbmNsdWRlIHRoZSB2ZXJzaW9uIChlLmcuLCAvdjMvcXVvdGF0aW9ucylcbiAgY29uc3Qgc2lnbmF0dXJlUGF0aCA9IGAvdjMke3BhdGh9YDtcblxuICBjb25zdCB7IHNpZ25hdHVyZSwgdGltZXN0YW1wIH0gPSBhd2FpdCBzaWduUGF5bG9hZChtZXRob2QsIHNpZ25hdHVyZVBhdGgsIGJvZHlTdHJpbmcsIHNlY3JldCk7XG4gIGNvbnN0IHVwc3RyZWFtVXJsID0gYnVpbGRVcHN0cmVhbVVybChwYXRoLCBzYW5kYm94KTtcblxuICBjb25zdCB1cHN0cmVhbVJlc3BvbnNlID0gYXdhaXQgZmV0Y2godXBzdHJlYW1VcmwsIHtcbiAgICBtZXRob2QsXG4gICAgaGVhZGVyczoge1xuICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04JyxcbiAgICAgICdNYXJrZXQnOiBtYXJrZXQsXG4gICAgICBBdXRob3JpemF0aW9uOiBgaG1hYyAke2FwaUtleX06JHt0aW1lc3RhbXB9OiR7c2lnbmF0dXJlfWAsXG4gICAgICAnQWNjZXB0JzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgIH0sXG4gICAgLi4uKG1ldGhvZCAhPT0gJ0dFVCcgJiYgeyBib2R5OiBib2R5U3RyaW5nIH0pXG4gIH0pO1xuXG4gIGNvbnN0IHJlc3BvbnNlQm9keSA9IGF3YWl0IHVwc3RyZWFtUmVzcG9uc2UudGV4dCgpO1xuICBpZiAoIXVwc3RyZWFtUmVzcG9uc2Uub2spIHtcbiAgICBjb25zb2xlLmVycm9yKCdMYWxhbW92ZSB1cHN0cmVhbSBlcnJvcicsIHtcbiAgICAgIHN0YXR1czogdXBzdHJlYW1SZXNwb25zZS5zdGF0dXMsXG4gICAgICBib2R5OiByZXNwb25zZUJvZHksXG4gICAgICB1cmw6IHVwc3RyZWFtVXJsLFxuICAgICAgcGF5bG9hZFxuICAgIH0pO1xuICAgIHJldHVybiB7XG4gICAgICBlcnJvcjogcmVzcG9uc2VCb2R5IHx8ICdMYWxhbW92ZSB1cHN0cmVhbSBlcnJvcicsXG4gICAgICBzdGF0dXM6IHVwc3RyZWFtUmVzcG9uc2Uuc3RhdHVzXG4gICAgfTtcbiAgfVxuXG4gIHJldHVybiB7IGRhdGE6IEpTT04ucGFyc2UocmVzcG9uc2VCb2R5KSB9O1xufTtcblxuY29uc3QgYnVpbGRDb25maWcgPSAoYm9keTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gfCBudWxsKTogRGVsaXZlcnlTdG9yZUNvbmZpZyB8IG51bGwgPT4ge1xuICBpZiAoIWJvZHkpIHJldHVybiBudWxsO1xuICBjb25zdCBtYXJrZXQgPSBTdHJpbmcoYm9keS5tYXJrZXQgfHwgJycpO1xuICBjb25zdCBzZXJ2aWNlVHlwZSA9IFN0cmluZyhib2R5LnNlcnZpY2VUeXBlIHx8ICcnKTtcbiAgY29uc3Qgc3RvcmVOYW1lID0gU3RyaW5nKGJvZHkuc3RvcmVOYW1lIHx8ICcnKTtcbiAgY29uc3Qgc3RvcmVQaG9uZSA9IFN0cmluZyhib2R5LnN0b3JlUGhvbmUgfHwgJycpO1xuICBjb25zdCBzdG9yZUFkZHJlc3MgPSBTdHJpbmcoYm9keS5zdG9yZUFkZHJlc3MgfHwgJycpO1xuICBjb25zdCBzdG9yZUxhdGl0dWRlID0gTnVtYmVyKGJvZHkuc3RvcmVMYXRpdHVkZSk7XG4gIGNvbnN0IHN0b3JlTG9uZ2l0dWRlID0gTnVtYmVyKGJvZHkuc3RvcmVMb25naXR1ZGUpO1xuICBjb25zdCBzYW5kYm94ID0gQm9vbGVhbihib2R5LnNhbmRib3gpO1xuXG4gIGlmIChcbiAgICAhbWFya2V0IHx8XG4gICAgIXNlcnZpY2VUeXBlIHx8XG4gICAgIXN0b3JlTmFtZSB8fFxuICAgICFzdG9yZVBob25lIHx8XG4gICAgIXN0b3JlQWRkcmVzcyB8fFxuICAgIE51bWJlci5pc05hTihzdG9yZUxhdGl0dWRlKSB8fFxuICAgIE51bWJlci5pc05hTihzdG9yZUxvbmdpdHVkZSlcbiAgKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIG1hcmtldCxcbiAgICBzZXJ2aWNlVHlwZSxcbiAgICBzYW5kYm94LFxuICAgIHN0b3JlTmFtZSxcbiAgICBzdG9yZVBob25lLFxuICAgIHN0b3JlQWRkcmVzcyxcbiAgICBzdG9yZUxhdGl0dWRlLFxuICAgIHN0b3JlTG9uZ2l0dWRlXG4gIH07XG59O1xuXG5jb25zdCBoYW5kbGVRdW90ZSA9IGFzeW5jIChcbiAgYm9keTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4sXG4gIGNvbmZpZzogRGVsaXZlcnlTdG9yZUNvbmZpZ1xuKSA9PiB7XG4gIGNvbnN0IGRlbGl2ZXJ5QWRkcmVzcyA9IFN0cmluZyhib2R5LmRlbGl2ZXJ5QWRkcmVzcyB8fCAnJyk7XG4gIGNvbnN0IGRlbGl2ZXJ5TGF0ID0gTnVtYmVyKGJvZHkuZGVsaXZlcnlMYXQpO1xuICBjb25zdCBkZWxpdmVyeUxuZyA9IE51bWJlcihib2R5LmRlbGl2ZXJ5TG5nKTtcblxuICBpZiAoIWRlbGl2ZXJ5QWRkcmVzcyB8fCBOdW1iZXIuaXNOYU4oZGVsaXZlcnlMYXQpIHx8IE51bWJlci5pc05hTihkZWxpdmVyeUxuZykpIHtcbiAgICByZXR1cm4gcmVzcG9uZCh7IGVycm9yOiAnTWlzc2luZyBkZWxpdmVyeSBmaWVsZHMnIH0sIDQwMCk7XG4gIH1cblxuICBjb25zdCBsYW5ndWFnZSA9IGdldExhbmd1YWdlRm9yTWFya2V0KGNvbmZpZy5tYXJrZXQpO1xuICBjb25zdCBxdW90ZVBheWxvYWQgPSB7XG4gICAgZGF0YToge1xuICAgICAgc2VydmljZVR5cGU6IGNvbmZpZy5zZXJ2aWNlVHlwZSxcbiAgICAgIGxhbmd1YWdlLFxuICAgICAgc3RvcHM6IGNyZWF0ZVN0b3BzKFxuICAgICAgICBjb25maWcsXG4gICAgICAgIGRlbGl2ZXJ5QWRkcmVzcyxcbiAgICAgICAgeyBsYXQ6IGRlbGl2ZXJ5TGF0LCBsbmc6IGRlbGl2ZXJ5TG5nIH0sXG4gICAgICAgIGxhbmd1YWdlXG4gICAgICApLFxuICAgICAgaXRlbToge1xuICAgICAgICBxdWFudGl0eTogJzEnLFxuICAgICAgICB3ZWlnaHQ6ICdMRVNTX1RIQU5fM19LRycsXG4gICAgICAgIGNhdGVnb3JpZXM6IFsnRk9PRF9ERUxJVkVSWSddLFxuICAgICAgICBoYW5kbGluZ0luc3RydWN0aW9uczogWydLRUVQX1VQUklHSFQnXVxuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBjb25zdCByZXN1bHQgPSBhd2FpdCBwcm94eVJlcXVlc3QoJy9xdW90YXRpb25zJywgcXVvdGVQYXlsb2FkLCBjb25maWcubWFya2V0LCBjb25maWcuc2FuZGJveCk7XG4gIGlmICgnZXJyb3InIGluIHJlc3VsdCkge1xuICAgIHJldHVybiByZXNwb25kKHsgZXJyb3I6IHJlc3VsdC5lcnJvciB9LCByZXN1bHQuc3RhdHVzIHx8IDUwMCk7XG4gIH1cblxuICByZXR1cm4gcmVzcG9uZCh7XG4gICAgcXVvdGF0aW9uSWQ6IHJlc3VsdC5kYXRhLmRhdGE/LnF1b3RhdGlvbklkLFxuICAgIHByaWNlOiByZXN1bHQuZGF0YS5kYXRhPy5wcmljZUJyZWFrZG93bj8udG90YWwsXG4gICAgY3VycmVuY3k6IHJlc3VsdC5kYXRhLmRhdGE/LnByaWNlQnJlYWtkb3duPy5jdXJyZW5jeSxcbiAgICBleHBpcmVzQXQ6IHJlc3VsdC5kYXRhLmRhdGE/LmV4cGlyZXNBdFxuICB9KTtcbn07XG5cbmNvbnN0IGhhbmRsZU9yZGVyID0gYXN5bmMgKFxuICBib2R5OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPixcbiAgY29uZmlnOiBEZWxpdmVyeVN0b3JlQ29uZmlnXG4pID0+IHtcbiAgY29uc3QgcXVvdGF0aW9uSWQgPSBTdHJpbmcoYm9keS5xdW90YXRpb25JZCB8fCAnJyk7XG4gIGNvbnN0IHJlY2lwaWVudE5hbWUgPSBTdHJpbmcoYm9keS5yZWNpcGllbnROYW1lIHx8ICcnKTtcbiAgY29uc3QgcmVjaXBpZW50UGhvbmUgPSBTdHJpbmcoYm9keS5yZWNpcGllbnRQaG9uZSB8fCAnJyk7XG5cbiAgaWYgKCFxdW90YXRpb25JZCB8fCAhcmVjaXBpZW50TmFtZSB8fCAhcmVjaXBpZW50UGhvbmUpIHtcbiAgICByZXR1cm4gcmVzcG9uZCh7IGVycm9yOiAnTWlzc2luZyBvcmRlciBmaWVsZHMnIH0sIDQwMCk7XG4gIH1cblxuICAvLyBOb3JtYWxpemUgcGhvbmUgbnVtYmVycyB0byBlLjE2NCBmb3JtYXRcbiAgY29uc3Qgbm9ybWFsaXplUGhvbmUgPSAocGhvbmU6IHN0cmluZyk6IHN0cmluZyA9PiB7XG4gICAgaWYgKCFwaG9uZSkgcmV0dXJuIHBob25lO1xuICAgIGNvbnN0IGRpZ2l0cyA9IHBob25lLnJlcGxhY2UoL1xcRC9nLCAnJyk7XG4gICAgaWYgKCFkaWdpdHMpIHJldHVybiBwaG9uZTtcbiAgICBpZiAoZGlnaXRzLnN0YXJ0c1dpdGgoJzYzJykpIHtcbiAgICAgIHJldHVybiBgKyR7ZGlnaXRzfWA7XG4gICAgfSBlbHNlIGlmIChkaWdpdHMuc3RhcnRzV2l0aCgnMCcpKSB7XG4gICAgICByZXR1cm4gYCs2MyR7ZGlnaXRzLnNsaWNlKDEpfWA7XG4gICAgfSBlbHNlIGlmIChkaWdpdHMuc3RhcnRzV2l0aCgnOScpKSB7XG4gICAgICByZXR1cm4gYCs2MyR7ZGlnaXRzfWA7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBgKzYzJHtkaWdpdHN9YDtcbiAgICB9XG4gIH07XG5cbiAgLy8gRmV0Y2ggcXVvdGF0aW9uIHRvIGdldCBzdG9wIElEcyAoaWYgbm90IHByb3ZpZGVkKVxuICBsZXQgc2VuZGVyU3RvcElkID0gYm9keS5zZW5kZXJTdG9wSWQgYXMgc3RyaW5nIHwgdW5kZWZpbmVkO1xuICBsZXQgcmVjaXBpZW50U3RvcElkID0gYm9keS5yZWNpcGllbnRTdG9wSWQgYXMgc3RyaW5nIHwgdW5kZWZpbmVkO1xuICBsZXQgcXVvdGF0aW9uU2NoZWR1bGVBdDogc3RyaW5nIHwgdW5kZWZpbmVkID0gdW5kZWZpbmVkO1xuICBsZXQgc2hvdWxkVXNlU2NoZWR1bGVBdCA9IGZhbHNlO1xuXG4gIGlmICghc2VuZGVyU3RvcElkIHx8ICFyZWNpcGllbnRTdG9wSWQpIHtcbiAgICB0cnkge1xuICAgICAgLy8gRmV0Y2ggcXVvdGF0aW9uIHRvIGdldCBzdG9wIElEc1xuICAgICAgY29uc3QgcXVvdGVSZXN1bHQgPSBhd2FpdCBwcm94eVJlcXVlc3QoYC9xdW90YXRpb25zLyR7cXVvdGF0aW9uSWR9YCwge30sIGNvbmZpZy5tYXJrZXQsIGNvbmZpZy5zYW5kYm94LCAnR0VUJyk7XG4gICAgICBpZiAoJ2Vycm9yJyBpbiBxdW90ZVJlc3VsdCkge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gZmV0Y2ggcXVvdGF0aW9uOicsIHF1b3RlUmVzdWx0LmVycm9yKTtcbiAgICAgICAgcmV0dXJuIHJlc3BvbmQoeyBlcnJvcjogYEZhaWxlZCB0byBmZXRjaCBxdW90YXRpb246ICR7cXVvdGVSZXN1bHQuZXJyb3J9YCB9LCBxdW90ZVJlc3VsdC5zdGF0dXMgfHwgNTAwKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHF1b3RhdGlvbiA9IHF1b3RlUmVzdWx0LmRhdGE/LmRhdGEgfHwgcXVvdGVSZXN1bHQuZGF0YTtcbiAgICAgIFxuICAgICAgLy8gTG9nIHF1b3RhdGlvbiBzdHJ1Y3R1cmUgZm9yIGRlYnVnZ2luZ1xuICAgICAgY29uc29sZS5sb2coJ1F1b3RhdGlvbiByZXNwb25zZSBzdHJ1Y3R1cmU6JywgSlNPTi5zdHJpbmdpZnkocXVvdGF0aW9uLCBudWxsLCAyKSk7XG4gICAgICBcbiAgICAgIC8vIENoZWNrIGlmIHF1b3RhdGlvbiBoYXMgZXhwaXJlZFxuICAgICAgY29uc3QgZXhwaXJlc0F0ID0gcXVvdGF0aW9uPy5leHBpcmVzQXQ7XG4gICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgICAgXG4gICAgICBpZiAoZXhwaXJlc0F0KSB7XG4gICAgICAgIGNvbnN0IGV4cGlyYXRpb25UaW1lID0gbmV3IERhdGUoZXhwaXJlc0F0KTtcbiAgICAgICAgaWYgKG5vdyA+IGV4cGlyYXRpb25UaW1lKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignUXVvdGF0aW9uIGhhcyBleHBpcmVkOicsIHtcbiAgICAgICAgICAgIHF1b3RhdGlvbklkLFxuICAgICAgICAgICAgZXhwaXJlc0F0LFxuICAgICAgICAgICAgY3VycmVudFRpbWU6IG5vdy50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgdGltZURpZmZlcmVuY2U6IG5vdy5nZXRUaW1lKCkgLSBleHBpcmF0aW9uVGltZS5nZXRUaW1lKClcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm4gcmVzcG9uZCh7IFxuICAgICAgICAgICAgZXJyb3I6IGBRdW90YXRpb24gaGFzIGV4cGlyZWQuIEV4cGlyZWQgYXQgJHtleHBpcmVzQXR9LiBQbGVhc2UgcmVxdWVzdCBhIG5ldyBxdW90YXRpb24uYCBcbiAgICAgICAgICB9LCA0MDApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIENoZWNrIHNjaGVkdWxlQXQgdGltZSBpZiBwcmVzZW50XG4gICAgICBjb25zdCBzY2hlZHVsZUF0ID0gcXVvdGF0aW9uPy5zY2hlZHVsZUF0O1xuICAgICAgcXVvdGF0aW9uU2NoZWR1bGVBdCA9IHNjaGVkdWxlQXQ7XG4gICAgICBpZiAoc2NoZWR1bGVBdCkge1xuICAgICAgICBjb25zdCBzY2hlZHVsZVRpbWUgPSBuZXcgRGF0ZShzY2hlZHVsZUF0KTtcbiAgICAgICAgY29uc3QgdGltZURpZmYgPSBzY2hlZHVsZVRpbWUuZ2V0VGltZSgpIC0gbm93LmdldFRpbWUoKTtcbiAgICAgICAgY29uc3QgbWludXRlc0RpZmYgPSB0aW1lRGlmZiAvICgxMDAwICogNjApO1xuICAgICAgICBcbiAgICAgICAgLy8gSWYgc2NoZWR1bGUgdGltZSBpcyBpbiB0aGUgcGFzdCBidXQgd2l0aGluIDEwIG1pbnV0ZXMsIHRyZWF0IGFzIGltbWVkaWF0ZSBkZWxpdmVyeVxuICAgICAgICAvLyBUaGlzIGhhbmRsZXMgY2FzZXMgd2hlcmUgTGFsYW1vdmUgc2V0cyBhIHNjaGVkdWxlQXQgdGltZSB0aGF0IHBhc3NlcyBxdWlja2x5XG4gICAgICAgIGlmIChzY2hlZHVsZVRpbWUgPCBub3cpIHtcbiAgICAgICAgICBjb25zdCBtaW51dGVzUGFzdCA9IE1hdGguYWJzKG1pbnV0ZXNEaWZmKTtcbiAgICAgICAgICBpZiAobWludXRlc1Bhc3QgPD0gMTApIHtcbiAgICAgICAgICAgIC8vIFNjaGVkdWxlIHRpbWUgaXMgaW4gdGhlIHBhc3QgYnV0IHdpdGhpbiB0b2xlcmFuY2UgLSB0cmVhdCBhcyBpbW1lZGlhdGVcbiAgICAgICAgICAgIGNvbnNvbGUud2FybignUXVvdGF0aW9uIHNjaGVkdWxlIHRpbWUgaXMgaW4gdGhlIHBhc3QgYnV0IHdpdGhpbiB0b2xlcmFuY2UsIHRyZWF0aW5nIGFzIGltbWVkaWF0ZSBkZWxpdmVyeTonLCB7XG4gICAgICAgICAgICAgIHF1b3RhdGlvbklkLFxuICAgICAgICAgICAgICBzY2hlZHVsZUF0LFxuICAgICAgICAgICAgICBjdXJyZW50VGltZTogbm93LnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICAgIG1pbnV0ZXNQYXN0OiBtaW51dGVzUGFzdC50b0ZpeGVkKDIpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHNob3VsZFVzZVNjaGVkdWxlQXQgPSBmYWxzZTsgLy8gRG9uJ3QgaW5jbHVkZSBzY2hlZHVsZUF0IGluIG9yZGVyIHBheWxvYWRcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gU2NoZWR1bGUgdGltZSBpcyBzaWduaWZpY2FudGx5IGluIHRoZSBwYXN0IC0gcmVqZWN0XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdRdW90YXRpb24gc2NoZWR1bGUgdGltZSBpcyB0b28gZmFyIGluIHRoZSBwYXN0OicsIHtcbiAgICAgICAgICAgICAgcXVvdGF0aW9uSWQsXG4gICAgICAgICAgICAgIHNjaGVkdWxlQXQsXG4gICAgICAgICAgICAgIGN1cnJlbnRUaW1lOiBub3cudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgICAgbWludXRlc1Bhc3Q6IG1pbnV0ZXNQYXN0LnRvRml4ZWQoMilcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbmQoeyBcbiAgICAgICAgICAgICAgZXJyb3I6IGBRdW90YXRpb24gc2NoZWR1bGUgdGltZSAoJHtzY2hlZHVsZUF0fSkgaXMgdG9vIGZhciBpbiB0aGUgcGFzdCAoJHttaW51dGVzUGFzdC50b0ZpeGVkKDApfSBtaW51dGVzKS4gUGxlYXNlIHJlcXVlc3QgYSBuZXcgcXVvdGF0aW9uIGZvciBpbW1lZGlhdGUgZGVsaXZlcnkuYCBcbiAgICAgICAgICAgIH0sIDQwMCk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIFNjaGVkdWxlIHRpbWUgaXMgaW4gdGhlIGZ1dHVyZVxuICAgICAgICAgIGNvbnN0IGhvdXJzVW50aWxTY2hlZHVsZSA9IHRpbWVEaWZmIC8gKDEwMDAgKiA2MCAqIDYwKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBJZiBzY2hlZHVsZSB0aW1lIGlzIHRvbyBmYXIgaW4gdGhlIGZ1dHVyZSAobW9yZSB0aGFuIDI0IGhvdXJzKSwgd2FybiBidXQgYWxsb3dcbiAgICAgICAgICBpZiAoaG91cnNVbnRpbFNjaGVkdWxlID4gMjQpIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybignUXVvdGF0aW9uIHNjaGVkdWxlIHRpbWUgaXMgbW9yZSB0aGFuIDI0IGhvdXJzIGF3YXk6Jywge1xuICAgICAgICAgICAgICBxdW90YXRpb25JZCxcbiAgICAgICAgICAgICAgc2NoZWR1bGVBdCxcbiAgICAgICAgICAgICAgaG91cnNVbnRpbFNjaGVkdWxlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gVXNlIHRoZSBzY2hlZHVsZUF0IGZvciBmdXR1cmUgc2NoZWR1bGVkIGRlbGl2ZXJpZXNcbiAgICAgICAgICBzaG91bGRVc2VTY2hlZHVsZUF0ID0gdHJ1ZTtcbiAgICAgICAgICBjb25zb2xlLmxvZygnVXNpbmcgc2NoZWR1bGVkIHF1b3RhdGlvbjonLCB7XG4gICAgICAgICAgICBxdW90YXRpb25JZCxcbiAgICAgICAgICAgIHNjaGVkdWxlQXQsXG4gICAgICAgICAgICBob3Vyc1VudGlsU2NoZWR1bGU6IGhvdXJzVW50aWxTY2hlZHVsZS50b0ZpeGVkKDIpXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gVHJ5IGRpZmZlcmVudCBwb3NzaWJsZSByZXNwb25zZSBzdHJ1Y3R1cmVzXG4gICAgICAvLyBMYWxhbW92ZSByZXR1cm5zIHN0b3BzIHdpdGggJ3N0b3BJZCcgZmllbGQgKG5vdCAnaWQnKVxuICAgICAgY29uc3Qgc3RvcHMgPSBxdW90YXRpb24/LnN0b3BzIHx8IHF1b3RhdGlvbj8uZGF0YT8uc3RvcHMgfHwgW107XG4gICAgICBzZW5kZXJTdG9wSWQgPSBzdG9wc1swXT8uc3RvcElkIHx8IHN0b3BzWzBdPy5pZCB8fCAnJztcbiAgICAgIHJlY2lwaWVudFN0b3BJZCA9IHN0b3BzWzFdPy5zdG9wSWQgfHwgc3RvcHNbMV0/LmlkIHx8ICcnO1xuICAgICAgXG4gICAgICBpZiAoIXNlbmRlclN0b3BJZCB8fCAhcmVjaXBpZW50U3RvcElkKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ01pc3Npbmcgc3RvcCBJRHMgaW4gcXVvdGF0aW9uOicsIHtcbiAgICAgICAgICBxdW90YXRpb25JZCxcbiAgICAgICAgICBzdG9wcyxcbiAgICAgICAgICBxdW90YXRpb25TdHJ1Y3R1cmU6IE9iamVjdC5rZXlzKHF1b3RhdGlvbiB8fCB7fSlcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByZXNwb25kKHsgXG4gICAgICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gZXh0cmFjdCBzdG9wIElEcyBmcm9tIHF1b3RhdGlvbi4gUGxlYXNlIGNoZWNrIHF1b3RhdGlvbiByZXNwb25zZSBzdHJ1Y3R1cmUuJyBcbiAgICAgICAgfSwgNTAwKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgcXVvdGF0aW9uOicsIGVycm9yKTtcbiAgICAgIHJldHVybiByZXNwb25kKHsgZXJyb3I6ICdGYWlsZWQgdG8gZmV0Y2ggcXVvdGF0aW9uIGZvciBzdG9wIElEcycgfSwgNTAwKTtcbiAgICB9XG4gIH1cblxuICAvLyBOb3JtYWxpemUgYWxsIHBob25lIG51bWJlcnNcbiAgY29uc3Qgbm9ybWFsaXplZFN0b3JlUGhvbmUgPSBub3JtYWxpemVQaG9uZShjb25maWcuc3RvcmVQaG9uZSk7XG4gIGNvbnN0IG5vcm1hbGl6ZWRSZWNpcGllbnRQaG9uZSA9IG5vcm1hbGl6ZVBob25lKHJlY2lwaWVudFBob25lKTtcblxuICAvLyBCdWlsZCBvcmRlciBwYXlsb2FkXG4gIGNvbnN0IG9yZGVyUGF5bG9hZDogYW55ID0ge1xuICAgIGRhdGE6IHtcbiAgICAgIHF1b3RhdGlvbklkLFxuICAgICAgc2VuZGVyOiB7XG4gICAgICAgIHN0b3BJZDogc2VuZGVyU3RvcElkLFxuICAgICAgICBuYW1lOiBjb25maWcuc3RvcmVOYW1lLFxuICAgICAgICBwaG9uZTogbm9ybWFsaXplZFN0b3JlUGhvbmVcbiAgICAgIH0sXG4gICAgICByZWNpcGllbnRzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBzdG9wSWQ6IHJlY2lwaWVudFN0b3BJZCxcbiAgICAgICAgICBuYW1lOiByZWNpcGllbnROYW1lLFxuICAgICAgICAgIHBob25lOiBub3JtYWxpemVkUmVjaXBpZW50UGhvbmUsXG4gICAgICAgICAgcmVtYXJrczogYm9keS5yZWNpcGllbnRSZW1hcmtzIHx8ICcnXG4gICAgICAgIH1cbiAgICAgIF0sXG4gICAgICBpc1BPREVuYWJsZWQ6IHRydWUsXG4gICAgICBtZXRhZGF0YTogYm9keS5tZXRhZGF0YSB8fCB7fVxuICAgIH1cbiAgfTtcblxuICAvLyBPbmx5IGluY2x1ZGUgc2NoZWR1bGVBdCBpZiBpdCdzIHZhbGlkIGFuZCBpbiB0aGUgZnV0dXJlIChub3QgdHJlYXRlZCBhcyBpbW1lZGlhdGUpXG4gIC8vIElmIHNjaGVkdWxlQXQgaXMgaW4gdGhlIHBhc3QgYnV0IHdpdGhpbiB0b2xlcmFuY2UsIHdlIG9taXQgaXQgdG8gdHJlYXQgYXMgaW1tZWRpYXRlIGRlbGl2ZXJ5XG4gIGlmIChzaG91bGRVc2VTY2hlZHVsZUF0ICYmIHF1b3RhdGlvblNjaGVkdWxlQXQpIHtcbiAgICBvcmRlclBheWxvYWQuZGF0YS5zY2hlZHVsZUF0ID0gcXVvdGF0aW9uU2NoZWR1bGVBdDtcbiAgfVxuXG4gIC8vIExvZyBwYXlsb2FkIGZvciBkZWJ1Z2dpbmcgKHdpdGhvdXQgc2Vuc2l0aXZlIGRhdGEpXG4gIGNvbnNvbGUubG9nKCdMYWxhbW92ZSBvcmRlciBwYXlsb2FkOicsIHtcbiAgICBxdW90YXRpb25JZCxcbiAgICBzZW5kZXJTdG9wSWQsXG4gICAgcmVjaXBpZW50U3RvcElkLFxuICAgIHNlbmRlclBob25lOiBub3JtYWxpemVkU3RvcmVQaG9uZSxcbiAgICByZWNpcGllbnRQaG9uZTogbm9ybWFsaXplZFJlY2lwaWVudFBob25lXG4gIH0pO1xuXG4gIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHByb3h5UmVxdWVzdCgnL29yZGVycycsIG9yZGVyUGF5bG9hZCwgY29uZmlnLm1hcmtldCwgY29uZmlnLnNhbmRib3gpO1xuICBpZiAoJ2Vycm9yJyBpbiByZXN1bHQpIHtcbiAgICByZXR1cm4gcmVzcG9uZCh7IGVycm9yOiByZXN1bHQuZXJyb3IgfSwgcmVzdWx0LnN0YXR1cyB8fCA1MDApO1xuICB9XG5cbiAgcmV0dXJuIHJlc3BvbmQoe1xuICAgIG9yZGVySWQ6IHJlc3VsdC5kYXRhLmRhdGE/Lm9yZGVySWQsXG4gICAgc3RhdHVzOiByZXN1bHQuZGF0YS5kYXRhPy5zdGF0dXMsXG4gICAgc2hhcmVMaW5rOiByZXN1bHQuZGF0YS5kYXRhPy5zaGFyZUxpbmssXG4gICAgZHJpdmVySWQ6IHJlc3VsdC5kYXRhLmRhdGE/LmRyaXZlcklkXG4gIH0pO1xufTtcblxuZXhwb3J0IGNvbnN0IHJ1bnRpbWUgPSAnbm9kZWpzJztcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIE9QVElPTlMoKSB7XG4gIHJldHVybiBuZXcgTmV4dFJlc3BvbnNlKG51bGwsIHsgc3RhdHVzOiAyMDQsIGhlYWRlcnM6IENPUlNfSEVBREVSUyB9KTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QoXG4gIHJlcXVlc3Q6IE5leHRSZXF1ZXN0LFxuICB7IHBhcmFtcyB9OiB7IHBhcmFtczogeyBhY3Rpb246IHN0cmluZyB9IH1cbikge1xuICBjb25zdCBhY3Rpb24gPSBwYXJhbXMuYWN0aW9uO1xuICBpZiAoYWN0aW9uICE9PSAncXVvdGUnICYmIGFjdGlvbiAhPT0gJ29yZGVyJykge1xuICAgIHJldHVybiByZXNwb25kKHsgZXJyb3I6ICdBY3Rpb24gbm90IHN1cHBvcnRlZCcgfSwgNDA1KTtcbiAgfVxuXG4gIGxldCBib2R5OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgdHJ5IHtcbiAgICBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKCk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIHJlc3BvbmQoeyBlcnJvcjogJ0ludmFsaWQgSlNPTiBwYXlsb2FkJyB9LCA0MDApO1xuICB9XG5cbiAgY29uc3QgY29uZmlnID0gYnVpbGRDb25maWcoYm9keSk7XG4gIGlmICghY29uZmlnKSB7XG4gICAgcmV0dXJuIHJlc3BvbmQoeyBlcnJvcjogJ0ludmFsaWQgZGVsaXZlcnkgc3RvcmUgY29uZmlndXJhdGlvbicgfSwgNDAwKTtcbiAgfVxuXG4gIGlmIChhY3Rpb24gPT09ICdxdW90ZScpIHtcbiAgICByZXR1cm4gaGFuZGxlUXVvdGUoYm9keSwgY29uZmlnKTtcbiAgfVxuXG4gIHJldHVybiBoYW5kbGVPcmRlcihib2R5LCBjb25maWcpO1xufVxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsIkFQSV9CQVNFX1VSTCIsIkFQSV9TQU5EQk9YX1VSTCIsIkNPUlNfSEVBREVSUyIsInJlc3BvbmQiLCJib2R5Iiwic3RhdHVzIiwianNvbiIsImhlYWRlcnMiLCJnZXRFbnYiLCJrZXkiLCJ2YWx1ZSIsInByb2Nlc3MiLCJlbnYiLCJFcnJvciIsInNpZ25QYXlsb2FkIiwibWV0aG9kIiwicGF0aCIsInNlY3JldCIsInRpbWVzdGFtcCIsIkRhdGUiLCJnZXRUaW1lIiwidG9TdHJpbmciLCJlbmNvZGVyIiwiVGV4dEVuY29kZXIiLCJjcnlwdG8iLCJzdWJ0bGUiLCJpbXBvcnRLZXkiLCJlbmNvZGUiLCJuYW1lIiwiaGFzaCIsIm1lc3NhZ2UiLCJzaWduYXR1cmVCdWZmZXIiLCJzaWduIiwic2lnbmF0dXJlIiwiQnVmZmVyIiwiZnJvbSIsImdldExhbmd1YWdlRm9yTWFya2V0IiwibWFya2V0IiwibWFwIiwiSEsiLCJTRyIsIlRIIiwiUEgiLCJUVyIsIk1ZIiwiVk4iLCJjcmVhdGVTdG9wcyIsImNvbmZpZyIsImRlbGl2ZXJ5QWRkcmVzcyIsImRlbGl2ZXJ5Q29vcmRpbmF0ZXMiLCJsYW5ndWFnZSIsImNvb3JkaW5hdGVzIiwibGF0Iiwic3RvcmVMYXRpdHVkZSIsImxuZyIsInN0b3JlTG9uZ2l0dWRlIiwiYWRkcmVzcyIsInN0b3JlQWRkcmVzcyIsImJ1aWxkVXBzdHJlYW1VcmwiLCJzYW5kYm94IiwiYmFzZSIsInByb3h5UmVxdWVzdCIsInBheWxvYWQiLCJhcGlLZXkiLCJib2R5U3RyaW5nIiwiSlNPTiIsInN0cmluZ2lmeSIsInNpZ25hdHVyZVBhdGgiLCJ1cHN0cmVhbVVybCIsInVwc3RyZWFtUmVzcG9uc2UiLCJmZXRjaCIsIkF1dGhvcml6YXRpb24iLCJyZXNwb25zZUJvZHkiLCJ0ZXh0Iiwib2siLCJjb25zb2xlIiwiZXJyb3IiLCJ1cmwiLCJkYXRhIiwicGFyc2UiLCJidWlsZENvbmZpZyIsIlN0cmluZyIsInNlcnZpY2VUeXBlIiwic3RvcmVOYW1lIiwic3RvcmVQaG9uZSIsIk51bWJlciIsIkJvb2xlYW4iLCJpc05hTiIsImhhbmRsZVF1b3RlIiwiZGVsaXZlcnlMYXQiLCJkZWxpdmVyeUxuZyIsInF1b3RlUGF5bG9hZCIsInN0b3BzIiwiaXRlbSIsInF1YW50aXR5Iiwid2VpZ2h0IiwiY2F0ZWdvcmllcyIsImhhbmRsaW5nSW5zdHJ1Y3Rpb25zIiwicmVzdWx0IiwicXVvdGF0aW9uSWQiLCJwcmljZSIsInByaWNlQnJlYWtkb3duIiwidG90YWwiLCJjdXJyZW5jeSIsImV4cGlyZXNBdCIsImhhbmRsZU9yZGVyIiwicmVjaXBpZW50TmFtZSIsInJlY2lwaWVudFBob25lIiwibm9ybWFsaXplUGhvbmUiLCJwaG9uZSIsImRpZ2l0cyIsInJlcGxhY2UiLCJzdGFydHNXaXRoIiwic2xpY2UiLCJzZW5kZXJTdG9wSWQiLCJyZWNpcGllbnRTdG9wSWQiLCJxdW90YXRpb25TY2hlZHVsZUF0IiwidW5kZWZpbmVkIiwic2hvdWxkVXNlU2NoZWR1bGVBdCIsInF1b3RlUmVzdWx0IiwicXVvdGF0aW9uIiwibG9nIiwibm93IiwiZXhwaXJhdGlvblRpbWUiLCJjdXJyZW50VGltZSIsInRvSVNPU3RyaW5nIiwidGltZURpZmZlcmVuY2UiLCJzY2hlZHVsZUF0Iiwic2NoZWR1bGVUaW1lIiwidGltZURpZmYiLCJtaW51dGVzRGlmZiIsIm1pbnV0ZXNQYXN0IiwiTWF0aCIsImFicyIsIndhcm4iLCJ0b0ZpeGVkIiwiaG91cnNVbnRpbFNjaGVkdWxlIiwic3RvcElkIiwiaWQiLCJxdW90YXRpb25TdHJ1Y3R1cmUiLCJPYmplY3QiLCJrZXlzIiwibm9ybWFsaXplZFN0b3JlUGhvbmUiLCJub3JtYWxpemVkUmVjaXBpZW50UGhvbmUiLCJvcmRlclBheWxvYWQiLCJzZW5kZXIiLCJyZWNpcGllbnRzIiwicmVtYXJrcyIsInJlY2lwaWVudFJlbWFya3MiLCJpc1BPREVuYWJsZWQiLCJtZXRhZGF0YSIsInNlbmRlclBob25lIiwib3JkZXJJZCIsInNoYXJlTGluayIsImRyaXZlcklkIiwicnVudGltZSIsIk9QVElPTlMiLCJQT1NUIiwicmVxdWVzdCIsInBhcmFtcyIsImFjdGlvbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/api/lalamove/[action]/route.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Flalamove%2F%5Baction%5D%2Froute&page=%2Fapi%2Flalamove%2F%5Baction%5D%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Flalamove%2F%5Baction%5D%2Froute.ts&appDir=%2FUsers%2Fcodemedavid%2FDocuments%2Fstarrs%2FStarr-s-Famous-Shakes%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fcodemedavid%2FDocuments%2Fstarrs%2FStarr-s-Famous-Shakes&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();